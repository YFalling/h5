<!DOCTYPE html>
<html>
<head>
<title>宝贝520快乐！</title>
<meta name="author" content="A4 STUDIO"/>
<meta name="copyright" content="A4 STUDIO"/>
<meta name="keywords" content="A4 STUDIO,女朋友,动漫,恋爱,喜欢"/>
<meta name="description" content="A4 STUDIO - 专注创意设计与开发"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0"/>
<link rel="icon" href="./css/img/a4studio.ico" mce_href="./css/img/a4studio.ico" type="image/x-icon"/>  
<link rel="shortcut icon" href="./css/img/a4studio.ico" mce_href="./css/img/a4studio.ico" type="image/x-icon"/>
<link rel="stylesheet" href="./css/swiper.min.css"/>
<link rel="stylesheet" href="./css/style.css"/>
</head>
<body>
<div class="bg_layer">
	<div class="bg_layer_img"></div>
</div>
<div class="swiper-container">
<div class="swiper-wrapper">
	<div class="swiper-slide p1">
		<img class="to_fade a4_logo" src="./css/img/a4studio_1.png"/>
		<div class="music">
			<i class="icon-music open" num="1"></i>
			<audio src="./mp3/001.mp3" id="my_audio" loop="loop" autoplay="autoplay"></audio>
		</div>
		<p class="right_bottom_text">遇见你，是我此生最大的幸运。</p>
		<div class="to_m"><div class="to_rombo"></div></div>
		<div class="to_m1"><div class="to_rombo1"></div></div>
		<div class="to_m2"><div class="to_rombo"></div></div>
		<div class="to_m3"><div class="to_rombo2"></div></div>
		<div class="to_m4"><div class="to_rombo"></div></div>
		<div class="to_m5"><div class="to_rombo1"></div></div>
		<div class="d_box" style="width:70%;max-width:425px;">
			<img class="to_down contain s11" src="./css/img/00.png"/>
			<img class="to_up contain s12" src="./css/img/00.png"/>
		</div>
	</div>
	<div class="swiper-slide p1s">
		<div class="d_box" style="width:100%;height:100%;max-width:425px;">
			<img class="to_no contain s21" src="./css/img/00.png"/>
			<img class="to_no contain s22" src="./css/img/00.png"/>
			<img class="to_up1 contain s23" src="./css/img/00.png"/>
			<img class="to_up2 contain s24" src="./css/img/00.png"/>
			<img class="to_up3 contain s25" src="./css/img/00.png"/>
			<img class="message_line" src="./css/img/2line.png"/>
		</div>
	</div>
	<div class="swiper-slide p2">
		<div class="d_box d_box_2">
			<div class="hidden_layer"></div>
			<div class="up_cicle"></div>
			<div id="time_line">
				<ul class="to_time_line">
					<li class="s31"></li>
					<li class="s32"></li>
					<li class="s33"></li>
					<li class="s34"></li>
					<li class="s35"></li>
					<li class="s36"></li>
					<li class="s37"></li>
					<li class="s38"></li>
					<li class="s39"></li>
					<li class="s310"></li>
					<li class="s311"></li>
					<li class="s31"></li>
				</ul>
			</div>
			<div class="lyric_t">
				<div id="musicContent">
					<span class="musicContent02"></span>
				</div>
				<div class="time">
					<span class="now_time" id="now_time">00:00</span>
					<span class="all_time" id="all_time">00:00</span>
				</div>
				<div class="time_progress">
					<div class="progress">
						<p class="bar" id="bar"></p>
						<div class="btn" id="btn"></div>
					</div>
				</div>
				<div class="btnpic" item="0"></div>
			</div>
		</div>
	</div>
	<div class="swiper-slide p3">
		<div class="to_m"><div class="to_rombo"></div></div>
		<div class="to_m1"><div class="to_rombo1"></div></div>
		<div class="to_m2"><div class="to_rombo"></div></div>
		<div class="to_m3"><div class="to_rombo2"></div></div>
		<div class="to_m4"><div class="to_rombo"></div></div>
		<div class="to_m5"><div class="to_rombo1"></div></div>
		<div class="d_box" style="width:20%;max-width:425px;height:42%;">
			<img class="to_fade contain s41" src="./css/img/00.png"/>
			<img class="to_fade_l contain s42" src="./css/img/00.png"/>
			<img class="to_fade_ll contain s43" src="./css/img/00.png"/>
		</div>
	</div>
</div>
</div>

<script src="./js/jquery-1.11.0.min.js"></script>
<script src="./js/swiper.jquery.min.js"></script>
<script src="./js/swiper.min.js"></script>
<script src="./js/song.js"></script>
<script type="text/javascript">
function autoPlayMusic() {
	function musicInBrowserHandler() {
		musicPlay(true);
		document.body.removeEventListener('touchstart', musicInBrowserHandler);
	}
	document.body.addEventListener('touchstart', musicInBrowserHandler);

	function musicInWeixinHandler() {
		musicPlay(true);
		document.addEventListener("WeixinJSBridgeReady", function () {
			musicPlay(true);
		}, false);
		document.removeEventListener('DOMContentLoaded', musicInWeixinHandler);
	}
	document.addEventListener('DOMContentLoaded', musicInWeixinHandler);
}
function musicPlay(isPlay) {
	var audio = document.getElementById('my_audio');
	if (isPlay && audio.paused) {
		audio.play();
	}
	if (!isPlay && !audio.paused) {
		audio.pause();
	}
}
autoPlayMusic();

var swiper = new Swiper('.swiper-container', {
	pagination: '.swiper-pagination',
	direction: 'vertical',
	slidesPerView: 1,
	paginationClickable: true,
	spaceBetween: 30,
	mousewheelControl: true
});

$(".music").click(function(){
	if($(".icon-music").attr("num") == "1"){
		$(".icon-music").removeClass("open");
		$(".icon-music").attr("num","2")
		document.getElementById("my_audio").pause();
		$(".music_text").html("关闭");
		$(".music_text").addClass("show_hide");
		setTimeout(musicHide,2000);
	}else{
		$(".icon-music").attr("num","1");
		$(".icon-music").addClass("open");
		document.getElementById("my_audio").play();
		$(".music_text").html("开启");
		$(".music_text").addClass("show_hide");
		setTimeout(musicHide,2000);
	}
	function musicHide(){
		$(".music_text").removeClass("show_hide");
	}

});
</script>
<script type="text/javascript">
var my_audio = document.getElementById("my_audio");
var p_all=$(".progress").width();
var startX = startY = endX = endY = 0;  

//暂停或播放
function playPause(){
	if(my_audio.paused){
		my_audio.play();
		$(".img img").addClass("rainbow");
	}
	else{
		my_audio.pause();
		$(".img img").removeClass("rainbow");
	}
}
$(".btnpic").click(function(){
	if($(this).attr("item")=="0"){
		$(this).css("background-position","280px 0");
		$(this).attr("item","1");
	}else{
		$(this).css("background-position","0 0");
		$(this).attr("item","0");
	}
	
	playPause();
});

var lyric = parseLyric(songContent);
//显示歌词的元素
lyricContainer = document.getElementById('musicContent');
//audio播放的时候实时获取当前播放时间
my_audio.ontimeupdate = function(){
	//获取当前播放时间
	document.getElementById("now_time").innerHTML = timeFormat(my_audio.currentTime);
	//当前的长度
	now_long=my_audio.currentTime/my_audio.duration*p_all;
	$(".bar").css({width:now_long});
	var btn_l=now_long-10+'px';
	$(".btn").css({left:btn_l});
	//遍历所有歌词，看哪句歌词的时间与当然时间吻合
	for (var i = 0, l = lyric.length; i < l; i++) {
		if (this.currentTime /*当前播放的时间*/ > lyric[i][0]) {
			if(i>=1){
				$(".musicContent02").html(lyric[i][1]);
			}else{
				$(".musicContent02").html(lyric[i][1]);
			}
		};
		addListenTouch();
	};
};

//页面一旦加入就获取audio的总时间
my_audio.onprogress = function(){
	//总的长度
	document.getElementById("all_time").innerHTML = timeFormat(my_audio.duration);
};
// Time format converter - 00:00//时间格式转换器- 00:00
var timeFormat = function(seconds){
	var m = Math.floor(seconds/60)<10 ? "0"+Math.floor(seconds/60) : Math.floor(seconds/60);
	var s = Math.floor(seconds-(m*60))<10 ? "0"+Math.floor(seconds-(m*60)) : Math.floor(seconds-(m*60));
	return m+":"+s;
};	
//手动拉拽进度条的部分
function addListenTouch(){
	//var speed=$('.had-play');
	var btn=document.getElementById("btn");
	document.getElementById("btn").addEventListener("touchstart", touchStart, false);
	document.getElementById("btn").addEventListener("touchmove", touchMove, false);
	document.getElementById("btn").addEventListener("touchend", touchEnd, false);
	document.getElementById("musicContent").addEventListener("touchstart", touchStart, false);
	document.getElementById("musicContent").addEventListener("touchmove", touchMove, false);
	document.getElementById("musicContent").addEventListener("touchend", touchEnd, false);
}
function touchStart(e){
	e.preventDefault();
	var touch=e.touches[0];
	startX=touch.pageX;
	my_audio.pause();
	document.getElementById("all_time").innerHTML = timeFormat(my_audio.duration);	
	//歌词区域touch移动距离
	var touchSong = e.targetTouches[0];
	startSongX = touchSong.pageX;
	startSongY = touchSong.pageY;
}
//滑动
function touchMove(e){
	e.preventDefault();
	var touch=e.touches[0];
	x=touch.pageX-startX
	var widthBar=now_long+x;

	$(".bar").css({width:widthBar});
	if(widthBar<p_all){
		$("#btn").css({left:widthBar-10+'px'});
		$("#bar").css({width:widthBar});	
	}
	var touchSong = e.targetTouches[0];
	endSongX = touchSong.pageX;
	endSongY = touchSong.pageY;
   
	var yu=widthBar/p_all*my_audio.duration;
	document.getElementById("now_time").innerHTML = timeFormat(yu);
}
function touchEnd(e){
	e.preventDefault();
	now_long=parseInt(btn.style.left);
	var touch=e.touches[0];
	var dragPaddingLeft=btn.style.left;
	var change=dragPaddingLeft.replace("px","");
	numDragpaddingLeft=parseInt(change);
	var currentTimeNew=(numDragpaddingLeft/(p_all-20)*my_audio.duration);
	
	my_audio.currentTime = currentTimeNew;
	document.getElementById("now_time").innerHTML = timeFormat(currentTimeNew);
	my_audio.play();
	document.getElementById("all_time").innerHTML = timeFormat(my_audio.duration);	
	console.log("垂直移动距离=    "+(endSongY-startSongY));
}
</script>
</body>
</html>